schema_version: 2
current_sprint:
  - id: T-008
    title: Rebaseline workspace state for domain-stacked shared-x rendering
    owner: Executor
    dod:
      - Align `WorkspaceState`/`PlotState`/`AxisState` types with ADR-0002 and remove overlay-specific assumptions.
      - Ensure axis order in `plot.axes` is treated as top-to-bottom lane order.
      - Update reducer actions and invariants for axis add/remove/reorder under the lane model.
      - Preserve trace-instance semantics so a signal can appear in multiple lanes.
    verify:
      - npm run lint
      - npm test -- tests/unit/webview/workspaceState.test.ts
    links:
      scratchpad: agents/scratchpads/T-008.md
      spec: doc/specs/domain-stacked-shared-x-implementation.md
      adr: agents/adr/ADR-0002-domain-stacked-yaxes-shared-x.md
    files:
      - src/webview/state/workspaceState.ts
      - src/webview/state/reducer.ts
      - tests/unit/webview/workspaceState.test.ts
      - agents/scratchpads/T-008.md
  - id: T-009
    title: Implement Plotly domain-stacked lanes with shared x-axis rangeslider
    owner: Executor
    depends_on:
      - T-008
    dod:
      - Replace overlay-axis rendering with non-overlapping domain-stacked `yaxis*` layout.
      - Enforce one shared `xaxis` and one shared `xaxis.rangeslider` per plot tab.
      - Implement deterministic domain calculation per spec (`g=0.04`, top-to-bottom from axis order).
      - Update relayout parsing for shared x-range and per-lane y-range capture.
    verify:
      - npm run lint
      - npm test -- tests/unit/webview/plotly/adapter.test.ts
    links:
      scratchpad: agents/scratchpads/T-009.md
      spec: doc/specs/domain-stacked-shared-x-implementation.md
      adr: agents/adr/ADR-0002-domain-stacked-yaxes-shared-x.md
    files:
      - src/webview/plotly/adapter.ts
      - src/webview/plotly/renderPlot.ts
      - src/webview/main.ts
      - tests/unit/webview/plotly/adapter.test.ts
      - agents/scratchpads/T-009.md
backlog:
  - id: T-010
    title: Update axis manager UI for lane ordering and assignment clarity
    owner: Executor
    depends_on:
      - T-009
    dod:
      - Update Axis Manager interactions to reflect lane semantics (top/bottom ordering, not overlay side controls).
      - Add explicit reorder actions in UI and reducer integration.
      - Keep signal-to-axis assignment workflow explicit and consistent with trace-instance model.
      - Ensure axis deletion/reassignment UX remains deterministic and validation-safe.
    verify:
      - npm run lint
      - npm test
    links:
      scratchpad: agents/scratchpads/T-010.md
      spec: doc/specs/domain-stacked-shared-x-implementation.md
    files:
      - src/webview/components/AxisManager.ts
      - src/webview/components/SignalList.ts
      - src/webview/components/TraceList.ts
      - src/webview/main.ts
      - tests/unit/webview/workspaceState.test.ts
      - agents/scratchpads/T-010.md
  - id: T-011
    title: Revise plot spec schema and importer/exporter for ADR-0002 semantics
    owner: Executor
    depends_on:
      - T-010
    dod:
      - Update spec schema/types to represent domain-stacked lane semantics.
      - Keep deterministic ordering guarantees for plots, axes, and traces.
      - Define explicit handling for legacy specs (clear error or controlled migration path, documented in code/tests).
      - Update import/export validation for axis references and missing signals.
    verify:
      - npm run lint
      - npm test -- tests/unit/spec/roundtrip.test.ts tests/unit/spec/importErrors.test.ts
    links:
      scratchpad: agents/scratchpads/T-011.md
      spec: doc/specs/domain-stacked-shared-x-implementation.md
      adr: agents/adr/ADR-0002-domain-stacked-yaxes-shared-x.md
    files:
      - src/core/spec/plotSpecV1.ts
      - src/core/spec/exportSpec.ts
      - src/core/spec/importSpec.ts
      - tests/unit/spec/roundtrip.test.ts
      - tests/unit/spec/importErrors.test.ts
      - agents/scratchpads/T-011.md
  - id: T-012
    title: End-to-end regression coverage and docs refresh for domain-stacked behavior
    owner: Executor
    depends_on:
      - T-011
    dod:
      - Update e2e smoke scenario to verify stacked non-overlapping lanes and shared rangeslider behavior.
      - Refresh README workflow language to match lane terminology and controls.
      - Add regression assertions that prevent fallback to overlay-axis behavior.
      - Record known limits and follow-up items in docs (without expanding MVP scope).
    verify:
      - npm run lint
      - npm test
      - npm run test:e2e
    links:
      scratchpad: agents/scratchpads/T-012.md
      spec: doc/specs/domain-stacked-shared-x-implementation.md
    files:
      - tests/e2e/waveViewerReplay.test.ts
      - tests/extension/smoke.test.ts
      - README.md
      - doc/specs/wave-viewer-mvp.md
      - agents/scratchpads/T-012.md
exploration_candidates:
  - Evaluate dynamic lane heights and adaptive gaps for >8 axes.
  - Evaluate decimation strategy for large CSV files under shared-x lane rendering.
