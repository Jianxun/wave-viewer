schema_version: 2
current_sprint:
  - id: T-025
    title: Restore Explorer signal actions for standalone viewer launch
    owner: Executor
    dod:
      - Fix the regression where Explorer right-click `Add Signal to Plot` does nothing after launching Wave Viewer without an active CSV editor.
      - Keep current reducer semantics unchanged (`add-to-plot`, `add-to-new-axis`, `reveal-in-plot`) for side-panel actions.
      - Ensure host emits explicit actionable warning when no target viewer can accept a side-panel action.
      - Add/adjust smoke tests covering standalone launch + side-panel action flow.
    verify:
      - npm run lint
      - npm test -- tests/extension/smoke.test.ts
    links:
      scratchpad: agents/scratchpads/T-025.md
      spec: doc/specs/side-panel-workflow.md
      adr: agents/adr/ADR-0003-side-panel-first-workflow.md
    files:
      - src/extension.ts
      - tests/extension/smoke.test.ts
      - agents/scratchpads/T-025.md
  - id: T-026
    title: Introduce viewer-session registry in extension host
    owner: Executor
    depends_on:
      - T-025
    dod:
      - Add explicit `viewerId` identity for each open Wave Viewer panel and maintain host-side registry (`viewerId -> panel`, `viewerId -> dataset?`).
      - Track active/focused viewer session to route side-panel commands deterministically.
      - Remove reliance on single-key `datasetPath -> panel` assumptions for side-panel command routing.
      - Add regression tests for multiple-viewer routing and panel disposal cleanup.
    verify:
      - npm run lint
      - npm test -- tests/extension/smoke.test.ts
    links:
      scratchpad: agents/scratchpads/T-026.md
      spec: doc/specs/side-panel-workflow.md
      adr: agents/adr/ADR-0003-side-panel-first-workflow.md
    files:
      - src/extension.ts
      - tests/extension/smoke.test.ts
      - agents/scratchpads/T-026.md
  - id: T-027
    title: Add explicit viewer-binding protocol messages
    owner: Executor
    depends_on:
      - T-026
    dod:
      - Define and implement typed protocol messages for viewer binding updates (host -> webview) and side-panel trace injection using explicit tuple payloads `(x, y)` (host -> webview).
      - Use full inline numeric arrays in payloads for MVP; do not introduce chunk/handle streaming in this task.
      - Ensure protocol additions preserve backward-compatible reducer-level semantics for plot/lane assignment.
      - Add/adjust protocol contract tests and extension smoke tests for the new message types.
      - Keep runtime validation strict at host/webview boundaries.
    verify:
      - npm run lint
      - npm test -- tests/unit/protocol/messages.test.ts tests/extension/smoke.test.ts
    links:
      scratchpad: agents/scratchpads/T-027.md
      spec: doc/specs/host-webview-protocol.md
      adr: agents/adr/ADR-0006-trace-payload-independent-variable-tuples.md
    files:
      - src/extension.ts
      - src/webview/main.ts
      - src/core/dataset/types.ts
      - tests/unit/protocol/messages.test.ts
      - tests/extension/smoke.test.ts
      - agents/scratchpads/T-027.md
  - id: T-028
    title: Refactor viewer signal panel to show available and per-lane assigned signals
    owner: Executor
    depends_on:
      - T-027
    dod:
      - Replace single flat signal list UX with sections that make lane assignment explicit (available signals + per-lane assignments).
      - Ensure UI remains deterministic and consistent with reducer state after add/remove/reassign/reorder operations.
      - Preserve existing drag/drop and quick-add functionality while updating signal display structure.
      - Add unit/smoke checks for new signal panel rendering and interactions.
    verify:
      - npm run lint
      - npm test -- tests/unit/webview/workspaceState.test.ts tests/extension/smoke.test.ts
    links:
      scratchpad: agents/scratchpads/T-028.md
      spec: doc/specs/side-panel-workflow.md
      adr: agents/adr/ADR-0003-side-panel-first-workflow.md
    files:
      - src/webview/components/SignalList.ts
      - src/webview/main.ts
      - src/webview/index.html
      - src/webview/styles.css
      - tests/extension/smoke.test.ts
      - agents/scratchpads/T-028.md
  - id: T-029
    title: Implement tuple-trace ingestion path from Explorer to viewer
    owner: Executor
    dod:
      - Implement host-side mapping from selected Explorer signal to explicit tuple trace payloads (`x[]`, `y[]`, metadata) for viewer delivery.
      - Ensure viewer state stores and renders only trace tuples received from host; avoid deriving plot data from full dataset snapshots inside viewer.
      - Keep lane assignment and reducer behavior deterministic when adding tuple traces.
      - Add unit/smoke tests proving mixed-grid traces from different sources can coexist in one viewer session.
    verify:
      - npm run lint
      - npm test -- tests/extension/smoke.test.ts tests/unit/webview/workspaceState.test.ts
    links:
      scratchpad: agents/scratchpads/T-029.md
      spec: doc/specs/host-webview-protocol.md
      adr: agents/adr/ADR-0006-trace-payload-independent-variable-tuples.md
    files:
      - src/extension.ts
      - src/webview/main.ts
      - src/webview/plotly/adapter.ts
      - src/core/dataset/types.ts
      - tests/extension/smoke.test.ts
      - tests/unit/webview/workspaceState.test.ts
      - agents/scratchpads/T-029.md
backlog:
  - id: T-030
    title: Add deterministic `reference-only` spec persistence mode
    owner: Executor
    depends_on:
      - T-029
    dod:
      - Implement export/import path for `reference-only` specs that preserve plotting intent without embedding full sample arrays.
      - Ensure rerun workflow can bind fresh source data and reconstruct plot assignments deterministically.
      - Add validation and tests for missing/outdated references with clear actionable errors.
    verify:
      - npm run lint
      - npm test -- tests/unit/spec/importErrors.test.ts tests/unit/spec/roundtrip.test.ts tests/extension/smoke.test.ts
    links:
      scratchpad: agents/scratchpads/T-030.md
      spec: doc/specs/wave-viewer-mvp.md
      adr: agents/adr/ADR-0007-dual-spec-persistence-modes.md
    files:
      - src/core/spec/importSpec.ts
      - src/core/spec/exportSpec.ts
      - tests/unit/spec/importErrors.test.ts
      - tests/unit/spec/roundtrip.test.ts
      - tests/extension/smoke.test.ts
      - agents/scratchpads/T-030.md
  - id: T-031
    title: Add deterministic `portable-archive` spec mode with embedded trace tuples
    owner: Executor
    depends_on:
      - T-030
    dod:
      - Implement export/import path for `portable-archive` specs embedding full tuple trace data needed for offline replay.
      - Keep archive serialization deterministic (trace order, axis assignment, numeric array ordering).
      - Add regression tests validating archive replay works without accessing original source files.
    verify:
      - npm run lint
      - npm test -- tests/unit/spec/roundtrip.test.ts tests/extension/smoke.test.ts
    links:
      scratchpad: agents/scratchpads/T-031.md
      spec: doc/specs/wave-viewer-mvp.md
      adr: agents/adr/ADR-0007-dual-spec-persistence-modes.md
    files:
      - src/core/spec/importSpec.ts
      - src/core/spec/exportSpec.ts
      - src/core/spec/plotSpecV1.ts
      - tests/unit/spec/roundtrip.test.ts
      - tests/extension/smoke.test.ts
      - agents/scratchpads/T-031.md
exploration_candidates:
  - Evaluate migrating Wave Viewer from command-opened panel to custom editor architecture (`viewType`) only after side-panel workflow stabilization criteria are met.
  - Evaluate grouped signal tree taxonomy (flat vs prefix-grouped) for large datasets.
  - Evaluate decimation strategy for large CSV files under side-panel-driven multi-trace workflows.
