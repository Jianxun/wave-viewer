# T-003 Scratchpad

## Task summary (DoD + verify)
- DoD:
  - Parse CSV into `Dataset` with `path`, `rowCount`, and numeric `columns`.
  - Enforce parser error reporting for malformed rows and no-numeric-column cases.
  - Implement default X-signal selection rule (`time` if present else first numeric).
  - Send normalized dataset metadata from extension host to webview.
- Verify:
  - `npm run lint`
  - `npm test`

## Read (paths)
- `agents/roles/executor.md`
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`
- `doc/specs/wave-viewer-mvp.md`
- `src/extension.ts`
- `tests/extension/smoke.test.ts`
- `src/core/csv/parseCsv.ts`
- `src/core/dataset/types.ts`
- `src/core/dataset/selectDefaultX.ts`
- `tests/unit/csv/parseCsv.test.ts`
- `tests/unit/dataset/selectDefaultX.test.ts`

## Plan
1. Add failing tests for CSV parsing and default X selection behavior.
2. Implement dataset types and CSV parser with actionable errors.
3. Implement default X selector and integrate parser into extension dataset message payload.
4. Update extension tests for normalized dataset metadata messaging.
5. Run verification and finalize closeout details.

## Milestone notes
- 2026-02-11: Intake complete; task set to `in_progress`.
- 2026-02-11: Added failing unit tests for CSV parse contract and default X selection.
- 2026-02-11: Implemented parser + selector and reached green tests.
- 2026-02-11: Integrated normalized dataset metadata payload in extension bridge.

## Patch summary
- Added dataset model types in `src/core/dataset/types.ts`.
- Added `parseCsv` implementation in `src/core/csv/parseCsv.ts`:
  - validates header presence and row width consistency,
  - filters plottable columns to numeric-only columns,
  - returns normalized `Dataset` with `path`, `rowCount`, and numeric `columns`,
  - throws actionable errors for malformed rows and no numeric columns.
- Added `selectDefaultX` in `src/core/dataset/selectDefaultX.ts`:
  - selects `time` when present,
  - otherwise selects the first numeric column,
  - errors clearly for empty numeric-column datasets.
- Updated `src/extension.ts` to parse/load CSV before opening webview and post normalized dataset metadata:
  - payload now includes `rowCount`, numeric `columns` names, and `defaultXSignal`,
  - parser/load failures surface through `showError` and abort panel open.
- Added/updated tests:
  - `tests/unit/csv/parseCsv.test.ts`,
  - `tests/unit/dataset/selectDefaultX.test.ts`,
  - `tests/extension/smoke.test.ts` (metadata payload + load-error case).

## PR URL
- Pending PR open.

## Verification
- `npm run lint` passed.
- `npm test` passed (`12` tests total across 3 files).

## Status request
- Ready for Review (pending PR open and `tasks_state` update).

## Blockers / Questions
- None currently.

## Next steps
- Push branch, open PR, set task state to `ready_for_review`.
