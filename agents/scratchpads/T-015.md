# T-015 Scratchpad

## Task summary (DoD + verify)
- DoD:
  - Enable dragging signal items from the side-panel browser to axis-row drop targets.
  - Add visible row hover/drop affordances and support explicit new-axis target behavior.
  - Emit only normalized `webview/dropSignal` payloads from webview drop handling.
  - Keep reducer-driven updates deterministic and replay-compatible.
- Verify:
  - `npm run lint`
  - `npm test -- tests/unit/webview/workspaceState.test.ts tests/unit/webview/plotly/adapter.test.ts`

## Read (paths)
- agents/context/contract.md
- agents/context/project_status.md
- agents/context/tasks.yaml
- agents/context/tasks_state.yaml
- agents/roles/executor.md
- doc/vaporview-architecture-findings.md
- src/webview/plotly/adapter.ts
- src/webview/components/AxisManager.ts
- src/webview/main.ts
- src/webview/index.html
- src/webview/styles.css
- src/extension.ts
- tests/unit/webview/workspaceState.test.ts
- tests/unit/webview/plotly/adapter.test.ts
- tests/extension/smoke.test.ts

## Plan
- Add drag/drop handlers for axis rows with clear hover/active affordances.
- Ensure explicit new-axis drop target routes through normalized drop contract.
- Wire webview message emission to normalized `webview/dropSignal` payloads only.
- Validate deterministic reducer outcomes with targeted tests.

## Milestone notes
- Intake: corrected this scratchpad from incorrect `T-016` DoD text to `T-015` DoD and set `T-015` to `in_progress`.
- Implemented side-panel tree drag payload controller (`application/vnd.code.tree.waveViewer.signalBrowser` + `text/plain`) so webview row targets can parse stable signal payloads.
- Added webview drop parsing utility and axis-row/new-axis drop handling with row-level hover/active affordances.
- Confirmed drop handling emits normalized envelope-only `webview/dropSignal` payloads (`source: "axis-row"`) to host.
- Added tests for parser behavior and explicit new-axis drop semantics.

## Patch summary
- `src/extension/signalTree.ts`
  - Added `createSignalTreeDragAndDropController` and drag MIME constant.
- `src/extension.ts`
  - Switched signal tree registration to `createTreeView(... dragAndDropController ...)`.
- `src/webview/dropSignal.ts`
  - Added drop payload parser (`extractSignalFromDropData`) for tree MIME + plain text payloads.
- `src/webview/components/AxisManager.ts`
  - Added drop handlers for each axis row and explicit “new axis” drop row.
  - Added `drop-active` state handling and new drop callback props.
- `src/webview/main.ts`
  - Wired axis-row drops to emit normalized `webview/dropSignal` messages only.
- `src/webview/styles.css`
  - Added visual affordance styles for drop targets and active hover state.
- `tests/unit/webview/dropSignal.test.ts`
  - Added parser tests for plain text, object/array payloads, and malformed payload rejection.
- `tests/extension/smoke.test.ts`
  - Added deterministic behavior test for `target.kind = "new-axis"` drop handling.

## PR URL
- Pending PR creation/push.

## Verification
- `./venv/bin/python scripts/lint_tasks_state.py`
  - OK: tasks.yaml and tasks_state.yaml are consistent.
- `npm run lint`
  - pass
- `npm test -- tests/unit/webview/workspaceState.test.ts tests/unit/webview/plotly/adapter.test.ts`
  - pass (18 tests)
- `npm test -- tests/extension/smoke.test.ts tests/unit/webview/dropSignal.test.ts`
  - pass (20 tests)

## Status request
- In Progress (ready to open PR and then switch to `ready_for_review` with PR number).

## Blockers / Questions
- None.

## Next steps
- Push branch, open PR, set `T-015` `ready_for_review` with PR number, and run tasks-state linter again.
