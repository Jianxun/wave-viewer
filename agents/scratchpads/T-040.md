# T-040 Scratchpad

## Task summary (DoD + verify)
- Move the "drop to new lane" container from fixed bottom position to render immediately below the active lane container.
- Extend axis creation action shape to support insertion index/anchor (`afterAxisId` or equivalent) so new lane placement matches sidebar drop target position.
- Ensure a drop onto the new-lane container performs one atomic operation: create axis at target position, assign dropped trace/signal, and set that new axis active.
- Add reducer/adapter tests for axis insertion ordering and regression coverage for existing new-axis paths.

Verify:
- `npm run lint`
- `npm test -- tests/unit/webview/workspaceState.test.ts tests/unit/webview/plotly/adapter.test.ts tests/extension/smoke.test.ts`

## Read (paths)
- `agents/roles/executor.md`
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`
- `src/webview/components/SignalList.ts`
- `src/webview/components/AxisManager.ts`
- `src/webview/main.ts`
- `src/webview/state/workspaceState.ts`
- `src/webview/state/reducer.ts`
- `src/core/dataset/types.ts`
- `src/extension/workspaceActions.ts`
- `src/extension/types.ts`
- `tests/unit/webview/workspaceState.test.ts`
- `tests/unit/protocol/messages.test.ts`
- `tests/unit/webview/signalList.test.ts`
- `tests/extension/smoke.test.ts`

## Plan
- Add anchored axis insertion (`afterAxisId`) in workspace state/reducer and extension action plumbing.
- Wire protocol/runtime validation for anchored `new-axis` drop target payloads.
- Move the new-lane drop target into the signal-lane board below the active lane.
- Add/refresh tests for axis insertion order and new-axis regression paths.
- Run lint/test verification and prepare review handoff.

## Milestone notes
- Intake complete; `T-040` set to `in_progress` and linted via `scripts/lint_tasks_state.py`.
- Added `afterAxisId` insertion support to `axis/add` and drop/new-axis action flow.
- Moved new-lane drop target rendering from `AxisManager` to `SignalList` beneath active lane and forwarded `afterAxisId` in drop intent.
- Added protocol/runtime and integration regression coverage.

## Patch summary
- Axis creation now accepts optional insertion anchor: `axis/add` payload supports `afterAxisId` and inserts new axis immediately after that lane.
- Webview `dropSignal` `new-axis` target now supports optional `afterAxisId` (validated as axis id when present).
- Host drop/new-axis action path creates anchored axes and still performs atomic axis+trace mutation under one transaction.
- Sidebar new-lane drop target now renders in `SignalList` directly under active lane; old fixed-bottom axis-manager target removed.
- Updated tests:
  - workspace insertion ordering coverage
  - protocol parsing/validation coverage for anchored new-axis payloads
  - smoke coverage for anchored drop behavior and UI wiring location

## PR URL
- Pending (created in closeout step)

## Verification
- `npm run lint` ✅
- `npm test -- tests/unit/webview/workspaceState.test.ts tests/unit/webview/plotly/adapter.test.ts tests/extension/smoke.test.ts` ✅
- Additional focused checks:
  - `npm test -- tests/unit/webview/signalList.test.ts tests/unit/webview/workspaceState.test.ts tests/unit/protocol/messages.test.ts tests/extension/smoke.test.ts` ✅
  - `npm test -- tests/unit/webview/workspaceState.test.ts tests/unit/protocol/messages.test.ts tests/extension/smoke.test.ts` ✅

## Status request (Done / Blocked / In Progress)
- Done (ready for review handoff)

## Blockers / Questions
- None.

## Next steps
- Push branch and open PR to `main`.
- Set `T-040` to `ready_for_review` with PR number and lint task state.
