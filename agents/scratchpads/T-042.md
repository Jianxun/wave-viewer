# T-042 - Route explorer quick-add to active plot + active lane in multi-plot sessions

## Task summary (DoD + verify)
- Ensure side-panel quick-add applies to host `viewerState` active plot and active lane instead of stale/default local plot state.
- Keep tuple injection and quick-add sequencing deterministic.
- Add/extend tests for multi-plot quick-add targeting correctness.
- Verify:
  - `npm test -- tests/extension/smoke.test.ts`
  - `npm run lint`

## Read
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`
- `src/extension.ts`
- `src/extension/sidePanel.ts`
- `src/extension/types.ts`
- `src/core/dataset/types.ts`
- `src/webview/main.ts`
- `tests/extension/smoke.test.ts`
- `tests/unit/protocol/messages.test.ts`

## Plan
- Add failing coverage for quick-add host target metadata in smoke tests.
- Thread quick-add `plotId`/`axisId` through host message types and payload validation.
- Resolve quick-add target from authoritative host snapshot in extension command flow.
- Consume host-provided quick-add target in webview before posting `webview/intent/dropSignal`.
- Run required verification commands.

## Milestone notes
- Intake: `T-042` was `ready`; moved to `in_progress`, linted task state, created branch `feature/T-042-multiplot-quick-add-targeting`.
- TDD: Added smoke/protocol expectations for quick-add target metadata and parser behavior.
- Implementation: Routed quick-add through host snapshot `viewerState` and webview host-targeted drop intent dispatch.
- Verification: Required smoke/lint commands pass.

## Patch summary
- Added `quickAddTarget` (`plotId`, `axisId`) support to side-panel quick-add dependency contract.
- Updated extension quick-add execution path to source target plot/lane from host snapshot `viewerState`.
- Extended `host/sidePanelQuickAdd` payload shape and runtime validator to support optional paired target metadata.
- Updated webview quick-add handling to prefer host-provided target plot/lane for drop intent routing.
- Added regression coverage in smoke tests and protocol validator tests.

## PR URL
- Pending PR creation.

## Verification
- `npm test -- tests/extension/smoke.test.ts` (pass)
- `npm run lint` (pass)

## Status request
- In Progress (ready to open PR and then move to `ready_for_review`).

## Blockers / Questions
- None.

## Next steps
- Push branch and open PR to `main`.
- Set `T-042` to `ready_for_review` with PR number and lint task state.
