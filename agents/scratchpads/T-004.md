# T-004 Scratchpad

## Task summary (DoD + verify)
- DoD:
  - Implement `WorkspaceState`, `PlotState`, `AxisState`, and `TraceState` models per contract.
  - Support create/remove/rename plot tabs and active tab switching.
  - Support trace instance creation from signals with axis assignment (`y1..yN`).
  - Implement axis manager state operations (add axis, remove axis with validation, axis reassignment).
- Verify:
  - `npm run lint`
  - `npm test`

## Read (paths)
- `agents/roles/executor.md`
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`
- `doc/specs/wave-viewer-mvp.md`
- `src/webview/main.ts`
- `src/webview/index.html`
- `src/webview/styles.css`
- `tests/unit/webview/workspaceState.test.ts`

## Plan
1. Add failing unit tests for workspace state, tab operations, trace/axis operations, and validation rules.
2. Implement state models and reducer/state operations to satisfy tests and contract invariants.
3. Add minimal webview UI components (`Tabs`, `SignalList`, `TraceList`, `AxisManager`) wired to state actions.
4. Run verify commands, record results, and prepare PR closeout updates.

## Milestone notes
- 2026-02-11: Intake complete; task selected (`T-004`) and scratchpad created.
- 2026-02-11: Added failing unit tests for workspace/reducer tab, trace, and axis operations.
- 2026-02-11: Implemented workspace state model + reducer and satisfied unit tests.
- 2026-02-11: Added webview components and wired reducer-driven tab/trace/axis interactions in UI shell.

## Patch summary
- Added workspace state models and pure operations in `src/webview/state/workspaceState.ts`:
  - contract-aligned `WorkspaceState`, `PlotState`, `AxisState`, `TraceState` types,
  - tab lifecycle operations (create/remove/rename/set active),
  - trace instance operations (add/remove/visibility toggle/axis reassignment),
  - axis operations (add/update/remove with in-use validation and reassignment support).
- Added reducer action layer in `src/webview/state/reducer.ts` to centralize state transitions.
- Added webview components:
  - `src/webview/components/Tabs.ts`
  - `src/webview/components/SignalList.ts`
  - `src/webview/components/TraceList.ts`
  - `src/webview/components/AxisManager.ts`
- Updated `src/webview/main.ts` to:
  - initialize workspace from `host/datasetLoaded`,
  - dispatch reducer actions for tabs/signals/traces/axes,
  - render component sections and handle validation errors.
- Updated webview shell markup/styles for control sections:
  - `src/webview/index.html`
  - `src/webview/styles.css`
- Added `tests/unit/webview/workspaceState.test.ts` covering:
  - workspace bootstrapping,
  - tab add/rename/remove/switch,
  - trace creation on explicit axes including duplicate signal instances,
  - axis removal validation and reassignment,
  - reducer action sequencing.

## PR URL
- Pending PR open.

## Verification
- `npm run lint` passed.
- `npm test` passed (`19` tests total across `4` files).

## Status request
- Ready for Review (pending PR open and task-state update).

## Blockers / Questions
- None currently.

## Next steps
- Push branch, open PR, set task state to `ready_for_review`.
