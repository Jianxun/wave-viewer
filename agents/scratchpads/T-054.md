# T-054 - Reset Actions for Layout and Active Plot

## Task summary (DoD + verify)
- DoD:
  - Add `waveViewer.clearLayout` (Command Palette) with confirmation; reset workspace to one empty plot/lane while keeping dataset/layout binding.
  - Add in-viewer `Clear Plot` control with confirmation; reset only active plot traces/lanes while keeping plot tab and x signal.
  - Route both actions through host-authoritative state transactions and preserve autosave/external-edit behavior.
  - Keep current dataset and layout bindings intact for both flows; `clearLayout` does not create/rebind a new layout file.
- Verify:
  - `npm test -- tests/extension/smoke.test.ts`
  - `npm test -- tests/unit/webview/workspaceState.test.ts`
  - `npm run lint`

## Read (paths)
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`
- `src/extension.ts`
- `src/extension/commands.ts`
- `src/extension/types.ts`
- `src/core/dataset/types.ts`
- `src/webview/main.ts`
- `src/webview/index.html`
- `src/webview/styles.css`
- `src/webview/state/workspaceState.ts`
- `src/webview/state/reducer.ts`
- `tests/extension/smoke.test.ts`
- `tests/unit/webview/workspaceState.test.ts`
- `tests/unit/protocol/messages.test.ts`

## Plan
1. Add failing unit/protocol/smoke tests for clear-layout and clear-plot flows.
2. Implement workspace reset primitives and reducer actions.
3. Wire protocol intent parsing + host clear-plot transaction handling.
4. Add `waveViewer.clearLayout` command, registration, and package contributions.
5. Add in-webview `Clear Plot` control + confirmation intent.
6. Run required verification and close out task state.

## Milestone notes
- Added `clearActivePlot` and `clearLayout` state transitions, plus reducer actions (`plot/clear`, `workspace/clearLayout`).
- Added protocol support for `webview/intent/clearPlot` (type + validation).
- Added host handling for `webview/intent/clearPlot` and a new command factory `createClearLayoutCommand`.
- Registered/exported `waveViewer.clearLayout` in extension and package command metadata.
- Added `Clear Plot` button in webview header with confirmation and host intent posting.
- Expanded smoke/unit/protocol tests to cover all new command/intent behavior and wiring checks.

## Patch summary
- State layer:
  - `src/webview/state/workspaceState.ts`: added `clearActivePlot` and `clearLayout` helpers.
  - `src/webview/state/reducer.ts`: added `plot/clear` and `workspace/clearLayout` actions.
- Protocol/contracts:
  - `src/core/dataset/types.ts`: added `webview/intent/clearPlot` message type and payload validation.
  - `src/extension/types.ts`: extended `WebviewToHostMessage` with `clearPlot`; added `ClearLayoutCommandDeps`.
- Host command + intent handling:
  - `src/extension/commands.ts`: added clear-plot intent transaction path and `createClearLayoutCommand`.
  - `src/extension.ts`: exported/registered `CLEAR_LAYOUT_COMMAND` and wired dependencies.
  - `package.json`: added activation + command contribution for `waveViewer.clearLayout`.
- Webview UI:
  - `src/webview/index.html`: added `Clear Plot` button in plot header.
  - `src/webview/main.ts`: added `postClearPlot` intent and confirmation click handler.
  - `src/webview/styles.css`: updated plot header layout for title + action button.
- Tests:
  - `tests/unit/webview/workspaceState.test.ts`: added clear active plot and clear layout coverage.
  - `tests/unit/protocol/messages.test.ts`: added clearPlot protocol acceptance/rejection tests.
  - `tests/extension/smoke.test.ts`: added clear layout command id/behavior, clearPlot host transaction, and webview wiring checks.

## PR URL
- Pending

## Verification
- `npm test -- tests/extension/smoke.test.ts` (pass)
- `npm test -- tests/unit/webview/workspaceState.test.ts` (pass)
- `npm run lint` (pass)

## Status request
- In Progress (awaiting push + PR creation, then set `ready_for_review`)

## Blockers / Questions
- None.

## Next steps
- Push branch and open PR to `main`.
- Update `agents/context/tasks_state.yaml` with PR number and `ready_for_review`.
