# T-035 Scratchpad

## Task summary (DoD + verify)
- Implement host-owned `activeAxisByPlotId` lifecycle (set/select/fallback/remove/reassign behavior).
- Ensure explorer `Add to Plot` and quick-add target active axis by default.
- Ensure all new-axis operations set the newly created axis active in the same transaction.
- Add UI indication for active axis and tests for targeting consistency across entry paths.

Verify:
- `npm run lint`
- `npm test -- tests/extension/smoke.test.ts tests/unit/webview/signalList.test.ts`

## Read (paths)
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`
- `agents/adr/ADR-0011-active-axis-targeting-and-new-axis-activation.md`
- `doc/specs/side-panel-workflow.md`

## Plan
- Inspect current active-axis lifecycle and command/drop targeting behavior.
- Add/adjust reducer/host logic so active-axis defaults are deterministic across entry paths.
- Ensure all new-axis operations set the new axis active atomically with trace insertion.
- Add webview active-axis visual indication and regression tests.
- Run verify commands and complete closeout artifacts.

## Milestone notes
- Intake complete.
- Added host transaction semantics for active-axis selection and deterministic lifecycle fallback.
- Routed side-panel add flows, quick-add (host-only path), and drop intents to use active-axis semantics.
- Added active-axis visual indication in axis manager rows.
- Added regression coverage for default targeting, new-axis activation, and fallback/reassignment behavior.

## Patch summary
- Updated host transaction/state lifecycle:
  - `src/extension/hostStateStore.ts` now supports transaction-level active-axis selection and enhanced fallback/reassign derivation.
- Updated host action routing:
  - `src/extension/workspaceActions.ts` adds axis-aware add-to-plot behavior with deterministic fallback.
  - `src/extension/sidePanel.ts` uses host active axis for add-to-plot and activates new axis on add-to-new-axis.
  - `src/extension/commands.ts` sets active axis for drop intents (axis target + new-axis target).
  - `src/extension.ts` applies active-axis defaults for quick-add when no viewer target is open.
- Updated webview UI indication:
  - `src/webview/components/AxisManager.ts` highlights active axis row and shows active chip.
  - `src/webview/main.ts` passes active axis into axis manager rendering.
  - `src/webview/styles.css` adds active-axis styling.
- Updated tests:
  - `tests/extension/smoke.test.ts` adds `T-035` active-axis targeting/lifecycle assertions.
  - `tests/unit/webview/signalList.test.ts` adds active-axis UI wiring/styling checks.

## PR URL
- Pending.

## Verification
- `npm run lint` (pass)
- `npm test -- tests/extension/smoke.test.ts tests/unit/webview/signalList.test.ts` (pass)

## Status request (Done / Blocked / In Progress)
- Done.

## Blockers / Questions
- None.

## Next steps
- Push branch, open PR to `main`, then set `T-035` to `ready_for_review` with PR number.
