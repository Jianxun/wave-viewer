# T-006 Scratchpad

## Task summary (DoD + verify)
- DoD:
  - Define `PlotSpec v1` YAML schema for workspace, plots, axes, traces, and ranges.
  - Implement export of deterministic rendered state fields to YAML.
  - Implement import path that reconstructs workspace and validates signal references.
  - Display explicit errors for missing signals/plots during spec import.
- Verify:
  - `npm run lint`
  - `npm test`

## Read (paths)
- `agents/roles/executor.md`
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`
- `doc/specs/wave-viewer-mvp.md`
- `src/extension.ts`
- `src/webview/main.ts`
- `src/webview/state/workspaceState.ts`
- `tests/extension/smoke.test.ts`

## Plan
1. Add failing unit tests for YAML export/import roundtrip and import errors.
2. Implement `PlotSpec v1` model + export/import logic with deterministic ordering.
3. Wire extension commands for export/import and explicit user-facing errors.
4. Run verification, update scratchpad/state, push, and open PR.

## Milestone notes
- 2026-02-11: Intake complete; selected `T-006`, created scratchpad.
- 2026-02-11: Added failing tests first for spec roundtrip and import errors.
- 2026-02-11: Implemented `PlotSpec v1` schema plus deterministic YAML export/import with strict validation.
- 2026-02-11: Added extension commands for YAML export/import and host<->webview workspace cache replay.
- 2026-02-11: Ran lint + full test suite successfully.

## Patch summary
- Added `PlotSpec v1` models and errors in `src/core/spec/plotSpecV1.ts`.
- Added deterministic YAML export in `src/core/spec/exportSpec.ts` with stable object/array ordering.
- Added strict YAML import/validation in `src/core/spec/importSpec.ts`:
  - validates schema version, required plot structure, axis/trace references, and tuple ranges,
  - reconstructs `WorkspaceState` (including `nextAxisNumber`),
  - emits explicit errors for missing plots, missing active plot, and missing signal references by plot.
- Added new unit coverage:
  - `tests/unit/spec/roundtrip.test.ts`,
  - `tests/unit/spec/importErrors.test.ts`.
- Wired command-level import/export in `src/extension.ts`:
  - `waveViewer.exportPlotSpec`,
  - `waveViewer.importPlotSpec`,
  - workspace cache via `webview/workspaceChanged` and replay via `host/workspaceLoaded`.
- Updated `src/webview/main.ts` to publish workspace state to host and apply imported workspace.
- Updated command contributions in `package.json` and added YAML dependency.

## PR URL
- Pending PR open.

## Verification
- `./venv/bin/python scripts/lint_tasks_state.py` passed.
- `npm test -- tests/unit/spec/roundtrip.test.ts tests/unit/spec/importErrors.test.ts` passed.
- `npm run lint` passed.
- `npm test` passed (`28` tests across `7` files).

## Status request
- Ready for Review (pending PR open and task-state PR link update).

## Blockers / Questions
- None currently.

## Next steps
- Push branch, open PR, update `T-006` task state with PR number, and hand off for review.
