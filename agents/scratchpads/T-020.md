# T-020 - Persist single-session loaded CSV registry for side-panel signal browser

## Task summary (DoD + verify)
- DoD:
  - Replace active-editor-derived signal listing with an explicit in-memory loaded-dataset registry for one Wave Viewer session.
  - Keep Explorer tree populated when focus moves from CSV editor to webview or other editors.
  - Render loaded files as parent nodes with signal children so signal actions can be scoped to a concrete loaded file.
  - Ensure existing side-panel signal actions continue to work against the selected dataset node context.
- Verify:
  - `npm run lint`
  - `npm test -- tests/extension/smoke.test.ts tests/unit/webview/workspaceState.test.ts`

## Read (paths)
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`

## Plan
- Move side-panel data source from active-editor CSV parsing to a session-level loaded dataset registry.
- Update signal tree model to show file nodes with child signal nodes.
- Keep existing signal actions working by carrying dataset context through tree items and command routing.
- Add/adjust smoke tests for persisted registry behavior and dataset-scoped actions.

## Milestone notes
- Intake complete. Task selected and status moved to `in_progress`.
- Implemented loaded-dataset registry in extension host and switched signal tree model to file-parent/signal-child entries.
- Verified command argument routing now preserves dataset path context for side-panel actions.
- Verification run:
  - `npm run lint` (pass)
  - `npm test -- tests/extension/smoke.test.ts tests/unit/webview/workspaceState.test.ts` (pass)

## Patch summary
- Updated `src/extension.ts`:
  - Added session-level `loadedDatasetByPath` registry.
  - Registered datasets when `openViewer` successfully parses CSV.
  - Removed active-editor-driven tree refresh/clear behavior.
  - Routed side-panel actions and quick-add through selected tree item dataset context.
- Updated `src/extension/signalTree.ts`:
  - Added dataset parent tree nodes and signal child nodes.
  - Added dataset-scoped command argument resolution (`signal + datasetPath`).
  - Limited drag payload sourcing to signal entries only.
- Updated tests:
  - `tests/extension/smoke.test.ts`: verifies `onDatasetLoaded` callback from open-viewer flow.
  - `tests/unit/extension/signalTree.test.ts`: verifies file-grouped tree structure and dataset-scoped signal resolution.

## PR URL
- https://github.com/Jianxun/wave-viewer/pull/24

## Verification
- `npm run lint` -> pass
- `npm test -- tests/extension/smoke.test.ts tests/unit/webview/workspaceState.test.ts` -> pass

## Status request (Done / Blocked / In Progress)
- Done

## Blockers / Questions
- None.

## Next steps
- Await reviewer feedback on PR.
