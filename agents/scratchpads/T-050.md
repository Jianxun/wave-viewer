# T-050 Scratchpad

## Task summary (DoD + verify)
- Replace current plot spec schema/contracts with v2-only layout schema (`version: 2`) using `dataset.path`, `active_plot`, per-plot `x`, and lane-grouped `signals`.
- Remove `mode` and `portable-archive` handling from spec parser/exporter paths.
- Reject unsupported schema versions (including v1) with actionable errors.
- Verify:
  - `npm test -- tests/unit/core/spec/importSpec.test.ts tests/unit/core/spec/exportSpec.test.ts`
  - `npm run lint`

## Read
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`
- `agents/adr/ADR-0013-layout-schema-v2-human-editable-mvp-only.md`
- `src/core/spec/plotSpecV1.ts`
- `src/core/spec/importSpec.ts`
- `src/core/spec/exportSpec.ts`
- `tests/unit/core/spec/importSpec.test.ts`
- `tests/unit/core/spec/exportSpec.test.ts`

## Plan
- Update unit tests for v2 schema contract and failure cases first.
- Refactor spec types + import/export logic to v2-only schema.
- Keep path resolution behavior, but remove mode/v1 handling.
- Run targeted tests, then lint.

## Milestone notes
- Intake complete.
- Migrated schema contract in `src/core/spec/*` to v2-only layout structure.
- Updated targeted spec unit tests to validate v2 behavior and v1 rejection.
- Verified `npm test -- tests/unit/core/spec/importSpec.test.ts tests/unit/core/spec/exportSpec.test.ts`.
- Verified `npm run lint`.

## Patch summary
- Replaced legacy v1 schema contract with v2 (`version: 2`, `active_plot`, per-plot `x`, lane-grouped `y[].signals`).
- Removed `mode`/`portable-archive` handling from import/export code paths.
- Added explicit unsupported-version error for non-v2 layouts.
- Preserved dataset path serialization/resolution behavior for layout-relative paths.
- Added parser behavior that maps user lane order to canonical runtime axes (`y1..yN`) and defaults imported traces to `visible: true`.
- Added missing type import in `src/extension.ts` required by current type-checking baseline.

## PR URL
- Pending.

## Verification
- `npm test -- tests/unit/core/spec/importSpec.test.ts tests/unit/core/spec/exportSpec.test.ts` (pass)
- `npm run lint` (pass)

## Status request (Done / Blocked / In Progress)
- In Progress

## Blockers / Questions
- None currently.

## Next steps
- Implement v2 parser/exporter updates and align tests.
