# T-023 Scratchpad

## Task summary (DoD + verify)
- Ensure Plotly canvas interactions remain fully functional when no drag operation is active: legend click toggles traces, hover cursor/tooltip behavior, pan/zoom interactions.
- Update canvas drop-overlay styling/behavior so overlay lanes never intercept pointer events outside active drag handling.
- If drag feedback requires interaction state, gate overlay visibility/activation to drag lifecycle events only (`dragenter`/`dragover`/`dragleave`/`drop`).
- Keep canvas overlay lane highlighting behavior intact during valid signal drag operations.
- Add regression coverage that validates overlay elements do not block normal plot interactions.

Verify:
- `npm run lint`
- `npm test -- tests/unit/webview/plotly/adapter.test.ts tests/extension/smoke.test.ts`

## Read (paths)
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`
- `agents/roles/executor.md`

## Plan
- Identify current drop-overlay DOM/CSS/event lifecycle in webview.
- Add drag-lifecycle-gated overlay activation that never blocks pointer events when idle.
- Add/update regression tests for non-blocking overlay behavior.
- Run required verification and record outcomes.

## Milestone notes
- Intake complete; task selected and role workflow initialized.
- Added failing regression checks for overlay interactivity and drag-lifecycle activation gating.
- Implemented drag-lifecycle overlay activation in webview and inert idle-overlay CSS behavior.
- Verified required lint and targeted tests pass.

## Patch summary
- Added regression coverage in `tests/extension/smoke.test.ts` that asserts:
  - overlay defaults to non-interactive hit-testing,
  - only `.drag-active` overlay state can receive drag hit-testing, and
  - main webview script gates activation through drag lifecycle handlers.
- Updated `src/webview/main.ts` to toggle canvas overlay active state only during valid drag events and clear lane highlight when drag ends.
- Updated `src/webview/styles.css` so overlay is hidden/inert by default, becomes visible/active during drag, and lane elements remain non-pointer-interactive.

## PR URL
- Pending PR creation.

## Verification
- `npm test -- tests/extension/smoke.test.ts tests/unit/webview/plotly/adapter.test.ts` (after adding regression tests): failed as expected (new assertions red).
- `npm test -- tests/extension/smoke.test.ts tests/unit/webview/plotly/adapter.test.ts`: pass.
- `npm run lint`: pass.

## Status request (Done / Blocked / In Progress)
- Done

## Blockers / Questions
- None currently.

## Next steps
- Push branch, open PR to `main`, set task to `ready_for_review` with PR number, and hand off to reviewer.
