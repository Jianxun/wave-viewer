# T-013 Scratchpad

## Task summary (DoD + verify)
- DoD:
  - Contribute a VS Code side-panel signal browser view for loaded numeric signals.
  - Implement a `TreeDataProvider` for signal entries with add-to-plot command support.
  - Wire extension-host actions so side-panel interactions add traces to the active plot deterministically.
  - Keep current in-webview signal controls functional as fallback during migration.
- Verify:
  - `npm run lint`
  - `npm test -- tests/extension/smoke.test.ts`
  - `npm test -- tests/unit/webview/workspaceState.test.ts`

## Read (paths)
- agents/context/contract.md
- agents/context/lessons.md
- agents/context/project_status.md
- agents/context/tasks.yaml
- agents/context/tasks_state.yaml
- agents/roles/executor.md
- doc/vaporview-architecture-findings.md
- package.json
- src/extension.ts
- src/webview/main.ts
- tests/extension/smoke.test.ts

## Plan
- Add side-panel view contribution and tree provider plumbing in extension host.
- Introduce add-to-plot command path from tree items to active plot state updates.
- Keep legacy in-webview signal-add path untouched while validating both entry points.
- Run verify commands and capture evidence.

## Milestone notes
- 2026-02-11: Added failing smoke tests for side-panel action command ids and reducer-compatible behavior.
- 2026-02-11: Implemented signal tree provider + side-panel command wiring in extension host with deterministic signal ordering.
- 2026-02-11: Preserved in-webview signal controls and kept reducer as the mutation source for side-panel actions.

## Patch summary
- Added `src/extension/signalTree.ts`:
  - signal tree provider factory for `waveViewer.signalBrowser`
  - deterministic signal ordering helper
  - signal argument extraction helper
  - side-panel command ids/constants
- Updated `src/extension.ts`:
  - side-panel action constants export
  - reducer-compatible `applySidePanelSignalAction` helper
  - panel tracking and workspace reload from side-panel actions
  - signal-tree registration and active editor refresh behavior
  - command registrations for `Add to Plot`, `Add to New Axis`, `Reveal in Plot`
- Updated `package.json`:
  - contributed side-panel view in explorer
  - contributed side-panel commands and context menu entries
  - added activation events for view and commands
- Updated `tests/extension/smoke.test.ts`:
  - added coverage for command ids and reducer-compatible side-panel action outcomes
  - added deterministic signal order check

## PR URL
- TBD

## Verification
- `npm run lint` ✅
- `npm test -- tests/extension/smoke.test.ts` ✅
- `npm test -- tests/unit/webview/workspaceState.test.ts` ✅
- `npm test -- tests/extension/smoke.test.ts tests/unit/webview/workspaceState.test.ts` ✅

## Status request
- In Progress

## Blockers / Questions
- None.

## Next steps
- Push branch, open PR to `main`, set `T-013` to `ready_for_review` with PR number.
