# T-033 Scratchpad

## Task summary (DoD + verify)
- Add typed/runtime-validated `webview/intent/*` messages and host `stateSnapshot/statePatch` messages with monotonic revision.
- Enforce stale host-state rejection in webview (`revision <= lastAppliedRevision` is ignored).
- Keep tuple transport separate from structural state updates.
- Add protocol contract tests for validation and revision ordering semantics.

Verify:
- `npm run lint`
- `npm test -- tests/unit/protocol/messages.test.ts tests/extension/smoke.test.ts`

## Read (paths)
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`
- `agents/adr/ADR-0010-revisioned-intent-based-protocol.md`
- `doc/specs/host-webview-protocol.md`

## Plan
- Inspect current protocol types/validators and message flows in host/webview.
- Add/adjust v2 typed message contracts and runtime validators for intents and revisioned host state messages.
- Enforce stale revision rejection on webview host-state apply path.
- Add/update protocol tests and smoke coverage for validation + revision ordering.
- Run verify commands and update task artifacts.

## Milestone notes
- Intake complete.

## Patch summary
- Pending.

## PR URL
- Pending.

## Verification
- Pending.

## Status request (Done / Blocked / In Progress)
- In Progress.

## Blockers / Questions
- None.

## Next steps
- Implement protocol updates and tests, then open PR and set `T-033` to `ready_for_review`.
