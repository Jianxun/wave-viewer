# T-009 Scratchpad

## Task summary (DoD + verify)
- Replace overlay-axis rendering with non-overlapping domain-stacked `yaxis*` layout.
- Enforce one shared `xaxis` and one shared `xaxis.rangeslider` per plot tab.
- Implement deterministic domain calculation per spec (`g=0.04`, top-to-bottom from axis order).
- Update relayout parsing for shared x-range and per-lane y-range capture.
- Verify:
  - `npm run lint`
  - `npm test -- tests/unit/webview/plotly/adapter.test.ts`

## Read (paths)
- doc/specs/domain-stacked-shared-x-implementation.md
- agents/adr/ADR-0002-domain-stacked-yaxes-shared-x.md
- agents/context/contract.md
- agents/context/tasks.yaml
- agents/context/tasks_state.yaml
- agents/context/project_status.md
- src/webview/plotly/adapter.ts
- src/webview/plotly/renderPlot.ts
- src/webview/main.ts
- tests/unit/webview/plotly/adapter.test.ts

## Plan
1. Add/adjust adapter tests to codify stacked-lane domains and single rangeslider behavior.
2. Implement adapter changes for lane-domain generation and shared `xaxis.rangeslider`.
3. Run required verification commands and fix any failures.
4. Prepare closeout updates (`tasks_state`, PR link, summary).

## Milestone notes
- Intake complete: `T-009` is `ready`, dependency `T-008` is `done`.
- TDD red: new domain/rangeslider assertions failed against overlay behavior.
- Implementation complete: domain-stacked lanes generated from axis order using fixed gap `g=0.04`.
- Verification green for required lint and targeted unit tests.

## Patch summary
- Updated `src/webview/plotly/adapter.ts`:
  - removed overlay-axis layout assumptions
  - added deterministic lane-domain builder with top-to-bottom axis order and clamping
  - set shared `xaxis.rangeslider: { visible: true }`
  - anchored all lane axes to shared `x`
- Updated `tests/unit/webview/plotly/adapter.test.ts`:
  - asserted rangeslider presence
  - asserted stacked lane domains for 1 lane and 3-lane order case
  - kept relayout parsing assertions for shared x and per-lane y capture/reset

## PR URL
- Pending PR creation.

## Verification
- `npm run lint` ✅
- `npm test -- tests/unit/webview/plotly/adapter.test.ts` ✅

## Status request
- Ready for Review (after PR is opened and `tasks_state.yaml` is updated with PR number)

## Blockers / Questions
- None.

## Next steps
- Push branch and open PR to `main`.
- Set `T-009` to `ready_for_review` with PR number, keep `merged: false`.
