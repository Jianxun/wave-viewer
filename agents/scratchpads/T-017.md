# T-017 Scratchpad

## Task summary (DoD + verify)
- DoD:
  - Add regression coverage proving equivalent workspace outcomes for side-panel command, axis-row drop, and canvas-overlay drop paths.
  - Verify fallback in-webview signal controls remain functional during stabilization window.
  - Record stabilization test evidence and residual risks in task scratchpad.
- Verify:
  - `npm run lint`
  - `npm test -- tests/extension/smoke.test.ts tests/unit/webview/workspaceState.test.ts tests/unit/webview/plotly/adapter.test.ts`

## Read (paths)
- agents/context/lessons.md
- agents/context/contract.md
- agents/context/tasks.yaml
- agents/context/tasks_state.yaml
- agents/context/project_status.md
- agents/roles/executor.md
- src/extension.ts
- src/webview/main.ts
- tests/extension/smoke.test.ts
- tests/unit/webview/workspaceState.test.ts
- tests/unit/webview/plotly/adapter.test.ts

## Plan
- Add parity-focused regression tests for side-panel command, axis-row drop, and canvas-overlay drop workflows.
- Add/expand tests to confirm fallback in-webview signal controls remain functional.
- Run verify commands, then document stabilization evidence and residual risk notes.

## Milestone notes
- 2026-02-11: Intake complete; selected `T-017`, created branch `feature/T-017-side-panel-parity-regression`, and initialized scratchpad.
- Added side-panel/axis-row/canvas-overlay parity regressions in extension smoke tests, including new-axis parity across sources.
- Added reducer-level regression covering in-webview fallback signal-list add controls (existing-axis + create-new axis flows).
- Verification run completed with required lint + test suites passing.

## Patch summary
- `tests/extension/smoke.test.ts`
  - Added regression proving equivalent workspace outcomes for side-panel command, axis-row drop, and canvas-overlay drop for axis-targeted adds.
  - Added regression proving equivalent workspace outcomes for new-axis adds across side-panel command and both drop sources.
- `tests/unit/webview/workspaceState.test.ts`
  - Added fallback-path regression that mirrors in-webview signal-list add behavior and asserts correct axis/trace outcomes.

## PR URL
- Pending PR creation/push.

## Verification
- `./venv/bin/python scripts/lint_tasks_state.py`
  - OK: tasks.yaml and tasks_state.yaml are consistent.
- `npm run lint`
  - pass
- `npm test -- tests/extension/smoke.test.ts tests/unit/webview/workspaceState.test.ts tests/unit/webview/plotly/adapter.test.ts`
  - pass (40 tests)

## Status request
- In Progress

## Blockers / Questions
- Residual risk: parity is validated at reducer/host-message handling level; no browser-level e2e currently asserts real pointer drag/drop interactions from side panel into canvas lanes.
- Residual risk: fallback signal-list flow is covered via reducer action sequence; UI event wiring in `src/webview/main.ts` remains indirectly covered.

## Next steps
- Push branch, open PR, then set `T-017` to `ready_for_review` with PR number and re-run task-state linter.
