# T-072 Scratchpad

## Task summary (DoD + verify)
- Add regression tests for valid log toggle, invalid log toggle rejection, relayout persistence, and replay/import roundtrip behavior.
- Confirm no regressions in existing lane/axis routing and snapshot replay flows.
- Ensure implementation conforms to frozen ADR/spec decisions from T-068/T-069 without editing ADR/spec/contract files.

Verify:
- `npm test -- tests/extension/smoke.test.ts tests/unit/spec/roundtrip.test.ts tests/unit/spec/importErrors.test.ts`
- `npm run lint`

## Read (paths)
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`
- `agents/roles/executor.md`
- `tests/extension/smoke.test.ts`
- `tests/unit/spec/roundtrip.test.ts`
- `tests/unit/spec/importErrors.test.ts`
- `tests/unit/webview/workspaceState.test.ts`
- `src/core/spec/exportSpec.ts`
- `src/core/spec/importSpec.ts`
- `src/core/spec/plotSpecV1.ts`

## Plan
- Add/adjust regression tests in the scoped files using TDD.
- Verify task-required test suites and lint.
- Prepare closeout notes with patch summary and verification output.

## Milestone notes
- Intake complete.
- Task branch created: `feature/T-072-xaxis-log-regression`.
- Task understanding: this task is test-only coverage hardening for the existing X-axis log-scale behavior from T-070/T-071, with no contract/spec edits.
- Added failing regression tests for `x.scale` layout replay/roundtrip and invalid `x.scale` import values.
- Added workspace reducer/state regressions for valid/invalid log toggles, relayout range persistence, and lane-routing stability.
- Implemented minimal spec import/export support for `x.scale` to satisfy replay and roundtrip behavior under test.
- Verification targets pass.

## Patch summary
- `tests/unit/webview/workspaceState.test.ts`
  - Added regression cases for `updatePlotXAxis` valid/invalid log-toggle behavior.
  - Added reducer regression case proving lane routing is unchanged when X-axis updates are applied.
- `tests/unit/spec/roundtrip.test.ts`
  - Added replay/import roundtrip case that asserts `x.scale: log` + `x.range` persistence.
- `tests/unit/spec/importErrors.test.ts`
  - Added import validation case rejecting invalid `x.scale`.
- `tests/extension/smoke.test.ts`
  - Added layout-open replay regression asserting host state patch preserves imported `xScale` and `xRange`.
  - Extended shared spec fixture helper to optionally include X-axis scale/range.
- `src/core/spec/plotSpecV1.ts`
  - Extended v3 spec x-config type with optional `scale`.
- `src/core/spec/exportSpec.ts`
  - Persisted `plot.xScale` into YAML `x.scale`.
- `src/core/spec/importSpec.ts`
  - Added `x.scale` validation (`linear|log`) and workspace mapping (`xScale`).

## PR URL
- Pending.

## Verification
- `npm test -- tests/unit/webview/workspaceState.test.ts tests/unit/spec/roundtrip.test.ts tests/unit/spec/importErrors.test.ts tests/extension/smoke.test.ts` ✅
- `npm test -- tests/extension/smoke.test.ts tests/unit/spec/roundtrip.test.ts tests/unit/spec/importErrors.test.ts` ✅
- `npm run lint` ✅

## Status request (Done / Blocked / In Progress)
- In Progress

## Blockers / Questions
- None.

## Next steps
- Push branch and open PR, then update `tasks_state` to `ready_for_review` with PR number.
