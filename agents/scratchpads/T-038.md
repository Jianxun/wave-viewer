# T-038 Scratchpad

## Task summary (DoD + verify)
- Replace the current Signal List + Trace List composition with one lane-oriented board that renders lane containers in the same order as plot lanes.
- Render each chip as a trace instance keyed by `trace.id` (not signal name) so duplicate same-signal traces can coexist and be manipulated independently.
- Support drag-and-drop of chips between lane containers to reassign `trace.axisId` without creating/removing traces.
- Keep per-chip controls minimal (`visible` toggle and remove) while preserving existing reducer semantics.
- Add/refresh focused component tests for duplicate-trace rendering and drag-reassign behavior.

Verify:
- `npm run lint`
- `npm test -- tests/unit/webview/signalList.test.ts tests/unit/webview/workspaceState.test.ts`

## Read (paths)
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`

## Plan
- Add/refresh tests for duplicate trace chips and drag-based lane reassignment.
- Refactor webview sidebar components into a single lane-aligned chip board keyed by `trace.id`.
- Keep reducer semantics intact while simplifying per-chip controls to visible/remove.
- Run verification and finalize handoff artifacts.

## Milestone notes
- Intake complete.
- Added focused `signalList` tests to cover duplicate trace-chip modeling and drag-based axis reassignment behavior.
- Replaced split sidebar signal/trace rendering with a single lane-aligned trace-chip board keyed by `trace.id`.
- Verified required lint and targeted unit tests passed.

## Patch summary
- `src/webview/components/SignalList.ts`
  - Reworked lane model to emit lane-local `traceChips` (full trace instances) instead of signal-name arrays.
  - Added `resolveTraceLaneReassignment` helper for deterministic drag/drop reassignment decisions.
  - Updated rendering to a lane board with per-trace chips keyed by `trace.id`, chip drag source wiring, lane drop handling, and minimal chip controls (`visible`, `remove`).
- `src/webview/main.ts`
  - Removed split `TraceList` render path and routed trace controls/reassignment callbacks through the unified `renderSignalList` lane board.
- `src/webview/index.html`
  - Replaced separate Signals/Traces sections with one `Lane Board` section.
- `src/webview/styles.css`
  - Added lane-board and trace-chip styling for draggable chips.
- `tests/unit/webview/signalList.test.ts`
  - Added/updated focused coverage for duplicate signal instances distinguished by unique `trace.id` and drag-reassign behavior.

## PR URL
- Pending.

## Verification
- `npm run lint` (pass)
- `npm test -- tests/unit/webview/signalList.test.ts tests/unit/webview/workspaceState.test.ts` (pass)

## Status request (Done / Blocked / In Progress)
- Done.

## Blockers / Questions
- None.

## Next steps
- Push branch, open PR to `main`, set `T-038` to `ready_for_review` with PR number, and hand off for review.
