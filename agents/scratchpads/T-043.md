# T-043 - Plot Rename Persistence

## Task summary (DoD + verify)
- Add host-backed rename intent path and remove local-only rename state mutation.
- Keep rename validation deterministic (trimmed non-empty names).
- Add test coverage for rename persistence after host patch/reload.
- Verify:
  - `npm test -- tests/extension/smoke.test.ts`
  - `npm run lint`

## Read
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`
- `src/webview/main.ts`
- `src/extension/commands.ts`
- `src/core/dataset/types.ts`
- `src/extension/types.ts`
- `tests/extension/smoke.test.ts`
- `tests/unit/protocol/messages.test.ts`

## Plan
1. Add failing tests for rename intent handling and persistence behavior.
2. Add rename intent contract/validation in shared protocol + extension message union.
3. Replace webview local rename dispatch with host intent post.
4. Handle rename intent in host transaction pipeline and emit `host/statePatch`.
5. Run verification, close out scratchpad, update task state, push branch, and open PR.

## Milestone notes
- Intake: `T-043` was `ready`; moved to `in_progress`, linted task state, and created branch `feature/T-043-plot-rename-persistence`.
- TDD: Added protocol + smoke coverage for `webview/intent/renamePlot`, host patch emission, and persistence through a follow-up `webview/ready` snapshot.
- Implementation: Added rename intent contract validation, webview rename intent posting, and host transaction handler with `plot/rename` reducer action.
- Verification: Required smoke/lint checks passed.

## Patch summary
- Added `webview/intent/renamePlot` to protocol message types and payload validation.
- Added `renamePlot` message variant to extension-facing `WebviewToHostMessage` typing.
- Replaced webview local `plot/rename` reducer dispatch with `postRenamePlot` intent posting using trimmed names.
- Added host-side rename intent handling in `createOpenViewerCommand` to commit a host transaction and emit `host/statePatch` with reason `renamePlot:tab-rename`.
- Added/extended tests in:
  - `tests/unit/protocol/messages.test.ts`
  - `tests/extension/smoke.test.ts`

## PR URL
- Pending.

## Verification
- `npm test -- tests/unit/protocol/messages.test.ts tests/extension/smoke.test.ts` (pass)
- `npm test -- tests/extension/smoke.test.ts` (pass)
- `npm run lint` (pass)

## Status request
- In Progress (ready to open PR and switch task to `ready_for_review`).

## Blockers / Questions
- None.

## Next steps
- Push branch, open PR to `main`, set `T-043` to `ready_for_review` with PR number, and lint task-state file.
